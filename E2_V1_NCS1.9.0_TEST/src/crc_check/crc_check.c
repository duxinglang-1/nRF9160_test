/****************************************Copyright (c)************************************************
** File Name:			    crc_check.c
** Descriptions:			data crc check process source file
** Created By:				xie biao
** Created Date:			2021-12-27
** Modified Date:      		2021-12-27 
** Version:			    	V1.0
******************************************************************************************************/
#include <nrf9160.h>
#include <kernel_structs.h>
#include <device.h>
#include <stdio.h>
#include <stdlib.h>
#include <zephyr.h>
#include "crc_check.h"
#include "logger.h"

CRC_8 crc_8 = {0x07,0x00,0x00,false,false};
CRC_8 crc_8_ITU = {0x07,0x00,0x55,false,false};
CRC_8 crc_8_ROHC = {0x07,0xff,0x00,true,true};
CRC_8 crc_8_MAXIM = {0x31,0x00,0x00,true,true};

CRC_16 crc_16_IBM = {0x8005,0x0000,0x0000,true,true};
CRC_16 crc_16_MAXIM = {0x8005,0x0000,0xffff,true,true};
CRC_16 crc_16_USB = {0x8005,0xffff,0xffff,true,true};
CRC_16 crc_16_MODBUS = {0x8005,0xffff,0x0000,true,true};
CRC_16 crc_16_CCITT = {0x1021,0x0000,0x0000,true,true};
CRC_16 crc_16_CCITT_FALSE = {0x1021,0xffff,0x0000,false,false};
CRC_16 crc_16_X5 = {0x1021,0xffff,0xffff,true,true};
CRC_16 crc_16_XMODEM = {0x1021,0x0000,0x0000,false,false};
CRC_16 crc_16_DNP = {0x3d65,0x0000,0xffff,true,true};

CRC_32 crc_32 = {0x04c11db7,0xffffffff,0xffffffff,true,true};
CRC_32 crc_32_MPEG2 = {0x04c11db7,0xffffffff,0x00000000,false,false};

uint8_t crc8_cal(uint8_t *addr, int num, CRC_8 type);
uint16_t crc16_cal(uint8_t *addr, int num, CRC_16 type);
uint32_t crc32_cal(uint8_t *addr, int num, CRC_32 type);

/*****************************************************************************
*function name:reverse8
*function: ï¿½Ö½Ú·ï¿½×ªï¿½ï¿½ï¿½ï¿½1100 0101 ï¿½ï¿½×ªï¿½ï¿½Îª1010 0011
*inputï¿½ï¿½1ï¿½Ö½ï¿½
*output:ï¿½ï¿½×ªï¿½ï¿½ï¿½Ö½ï¿½
******************************************************************************/
uint8_t reverse8(uint8_t data)
{
    uint8_t i;
    uint8_t temp=0;
	
    for(i=0;i<8;i++)	//ï¿½Ö½Ú·ï¿½×ª
        temp |= ((data>>i) & 0x01)<<(7-i);
    return temp;
}

/*****************************************************************************
*function name:reverse16
*function: Ë«ï¿½Ö½Ú·ï¿½×ªï¿½ï¿½ï¿½ï¿½1100 0101 1110 0101ï¿½ï¿½×ªï¿½ï¿½Îª1010 0111 1010 0011
*inputï¿½ï¿½Ë«ï¿½Ö½ï¿½
*output:ï¿½ï¿½×ªï¿½ï¿½Ë«ï¿½Ö½ï¿½
******************************************************************************/
uint16_t reverse16(uint16_t data)
{
    uint8_t i;
    uint16_t temp=0;
	
    for(i=0;i<16;i++)		//ï¿½ï¿½×ª
        temp |= ((data>>i) & 0x0001)<<(15-i);
    return temp;
}

/*****************************************************************************
*function name:reverse32
*function: 32bitï¿½Ö·ï¿½×ª
*inputï¿½ï¿½32bitï¿½ï¿½
*output:ï¿½ï¿½×ªï¿½ï¿½32bitï¿½ï¿½
******************************************************************************/
uint32_t reverse32(uint32_t data)
{
    uint8_t i;
    uint32_t temp=0;
	
    for(i=0;i<32;i++)		//ï¿½ï¿½×ª
        temp |= ((data>>i) & 0x01)<<(31-i);
    return temp;
}

//////////////////////////////////////////////////////////////////////////////////////////////
//1.ï¿½ï¿½ï¿½ã·¨ï¿½ï¿½ï¿½ï¿½ï¿½Ýµï¿½Ç°Ñ¡ï¿½ï¿½ï¿½CRCï¿½ï¿½×¼ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ë£¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ý¸ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ð²½¼ï¿½ï¿½ï¿½CRCÖµï¿½ï¿½
//  ï¿½Åµï¿½:Í¨ï¿½ï¿½ï¿½Ô£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¿Ç°Í¨ï¿½Ã±ï¿½×¼ï¿½Ô¼ï¿½ï¿½Í»ï¿½ï¿½Ô¶ï¿½ï¿½ï¿½ï¿½×
//  È±ï¿½ï¿½:Ã¿ï¿½ï¿½ï¿½ï¿½Òªï¿½ï¿½ï¿½ã£¬ï¿½È½Ïºï¿½Ê±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ï´ï¿½ï¿½Ê±ï¿½ï¿
//////////////////////////////////////////////////////////////////////////////////////////////

/*****************************************************************************
*function name:crc8_cal
*function: CRCÐ£ï¿½é£¬Ð£ï¿½ï¿½ÖµÎª8Î»
*input:addr-ï¿½ï¿½ï¿½ï¿½ï¿½×µï¿½Ö·ï¿½ï¿½num-ï¿½ï¿½ï¿½Ý³ï¿½ï¿½È£ï¿½ï¿½Ö½Ú£ï¿½ï¿½ï¿½type-CRC8ï¿½ï¿½ï¿½ã·¨ï¿½ï¿½ï¿½ï¿½
*output:8Î»Ð£ï¿½ï¿½Öµ
******************************************************************************/
uint8_t crc8_cal(uint8_t *addr, int num, CRC_8 type)  
{  
    uint8_t data;
    uint8_t crc = type.InitValue;					//ï¿½ï¿½Ê¼Öµ
    int i;
	
    for(;num>0;num--)               
    {  
        data = *addr++;
        if(type.InputReverse == true)
        	data = reverse8(data);				//ï¿½Ö½Ú·ï¿½×ª
        crc = crc^data;							//ï¿½ï¿½crcï¿½ï¿½Ê¼Öµï¿½ï¿½ï¿
        for(i=0;i<8;i++)						//Ñ­ï¿½ï¿½8Î» 
        {  
            if(crc&0x80)						//ï¿½ï¿½ï¿½ï¿½ï¿½Æ³ï¿½ï¿½ï¿½Î»Îª1ï¿½ï¿½ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½ï¿½
                crc = (crc<<1)^type.poly;    
            else								//ï¿½ï¿½ï¿½ï¿½Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
                crc <<= 1;                  
        }
    }

    if(type.OutputReverse == true)				//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½×ª
        crc = reverse8(crc);
    crc = crc^type.xor;							//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿
    return(crc);								//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ð£ï¿½ï¿½Öµ
}
 
/*****************************************************************************
*function name:crc16_cal
*function: CRCÐ£ï¿½é£¬Ð£ï¿½ï¿½ÖµÎª16Î»
*input:addr-ï¿½ï¿½ï¿½ï¿½ï¿½×µï¿½Ö·ï¿½ï¿½num-ï¿½ï¿½ï¿½Ý³ï¿½ï¿½È£ï¿½ï¿½Ö½Ú£ï¿½ï¿½ï¿½type-CRC16ï¿½ï¿½ï¿½ã·¨ï¿½ï¿½ï¿½ï¿½
*output:16Î»Ð£ï¿½ï¿½Öµ
******************************************************************************/
uint16_t crc16_cal(uint8_t *addr, int num, CRC_16 type)  
{  
    uint8_t data;
    uint16_t crc = type.InitValue;					//ï¿½ï¿½Ê¼Öµ
    int i; 
	
    for(;num>0;num--)               
    {  
        data = *addr++;
        if(type.InputReverse == true)
            data = reverse8(data);				//ï¿½Ö½Ú·ï¿½×ª
        crc = crc^(data<<8);					//ï¿½ï¿½crcï¿½ï¿½Ê¼Öµï¿½ï¿½8Î»ï¿½ï¿½ï¿
        for(i=0;i<8;i++)						//Ñ­ï¿½ï¿½8Î» 
        {  
            if(crc&0x8000)						//ï¿½ï¿½ï¿½ï¿½ï¿½Æ³ï¿½ï¿½ï¿½Î»Îª1ï¿½ï¿½ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½ï¿½
                crc = (crc<<1)^type.poly;    
            else								//ï¿½ï¿½ï¿½ï¿½Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
                crc <<= 1;                  
        }
    }
    if(type.OutputReverse == true)				//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½×ª
        crc = reverse16(crc);
    crc = crc^type.xor;							//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿
    return(crc);								//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ð£ï¿½ï¿½Öµ
}

/*****************************************************************************
*function name:crc32_cal
*function: CRCÐ£ï¿½é£¬Ð£ï¿½ï¿½ÖµÎª32Î»
*input:addr-ï¿½ï¿½ï¿½ï¿½ï¿½×µï¿½Ö·ï¿½ï¿½num-ï¿½ï¿½ï¿½Ý³ï¿½ï¿½È£ï¿½ï¿½Ö½Ú£ï¿½ï¿½ï¿½type-CRC32ï¿½ï¿½ï¿½ã·¨ï¿½ï¿½ï¿½ï¿½
*output:32Î»Ð£ï¿½ï¿½Öµ
******************************************************************************/
uint32_t crc32_cal(uint8_t *addr, int num, CRC_32 type)  
{  
    uint8_t data;
    uint32_t crc = type.InitValue;					//ï¿½ï¿½Ê¼Öµ
    int i;
	
    for(;num>0;num--)               
    {  
        data = *addr++;
        if(type.InputReverse == true)
            data = reverse8(data);				//ï¿½Ö½Ú·ï¿½×ª
        crc = crc^(data<<24);					//ï¿½ï¿½crcï¿½ï¿½Ê¼Öµï¿½ï¿½8Î»ï¿½ï¿½ï¿
        for(i=0;i<8;i++)						//Ñ­ï¿½ï¿½8Î» 
        {  
            if(crc&0x80000000)					//ï¿½ï¿½ï¿½ï¿½ï¿½Æ³ï¿½ï¿½ï¿½Î»Îª1ï¿½ï¿½ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½ï¿½
                crc = (crc<<1)^type.poly;    
            else								//ï¿½ï¿½ï¿½ï¿½Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
                crc <<= 1;                  
        }
    }
    if(type.OutputReverse == true)				//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½×ª
        crc = reverse32(crc);
    crc = crc^type.xor;							//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿
    return(crc);								//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ð£ï¿½ï¿½Öµ
}


//////////////////////////////////////////////////////////////////////////////////////////////
//2.ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ñ¡ï¿½Ãµï¿½CRCï¿½ï¿½ï¿½ï¿½ï¿½×¼ï¿½ó£¬¿ï¿½ï¿½ï¿½Í¨ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö±ï¿½Ó²ï¿½Ñ¯CRCÖµï¿½ï¿½ï¿½Ô¼Ó¿ï¿½ï¿½ï¿½ï¿½Ð§ï¿½ï¿
//	ï¿½Åµï¿½:Ð§ï¿½Ê¸ß£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê±ï¿½ï¿½
//	È±ï¿½ï¿½:ï¿½Ô¿Õ¼ä»»Ê±ï¿½ä£¬ï¿½ï¿½Òªï¿½È½ï¿½CRCï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú´æ£¬ï¿½ï¿½ï¿½Ò²ï¿½Í¬ï¿½Ä±ï¿½×¼ï¿½ï¿½CRCï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Í¨ï¿½ï¿½
//  ï¿½ï¿½Òª×¢ï¿½ï¿½ï¿½ï¿½Ç£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÃµÄ±ï¿½ï¿½ï¿½ï¿½Ý¶ï¿½ï¿½ï¿½Ê½ï¿½Ä²ï¿½Í¬ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ã²ï¿½Í¬ï¿½ï¿½ï¿½ï¿½Ê½Ê±ï¿½ï¿½Ò»ï¿½ï¿½Òªï¿½ï¿½ï¿½ï¿½
//  ï¿½ï¿½ï¿½É¶ï¿½Ó¦ï¿½Ä±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ô¶ï¿½ï¿½ï¿½Ê½Îª0x07ï¿½ï¿½u8 crc8ï¿½ï¿½ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ô¸ï¿½Ð´Îªï¿½ï¿½ï¿½Â£ï¿
//////////////////////////////////////////////////////////////////////////////////////////////

/*****************************************************************************
*function name:GenerateCrc8Table
*function: ï¿½ï¿½ï¿½ï¿½8Î»crcï¿½ï¿½
*input:addr-ï¿½ï¿½ï¿½ï¿½ï¿½×µï¿½Ö·ï¿½ï¿½num-ï¿½ï¿½ï¿½Ý³ï¿½ï¿½È£ï¿½ï¿½Ö½Ú£ï¿½ï¿½ï¿½type-CRC32ï¿½ï¿½ï¿½ã·¨ï¿½ï¿½ï¿½ï¿½
*output:32Î»Ð£ï¿½ï¿½Öµ
******************************************************************************/
void GenerateCrc8Table(uint8_t *crc8Table)  
{  
    uint8_t crc=0;
    uint16_t i,j;

    for(j=0;j<256;j++)
    {
        if(!(j%16))						//16ï¿½ï¿½ï¿½ï¿½Îª1ï¿½ï¿½
            LOGD("\r\n");
 
        crc = (uint8_t)j;
        for(i=0;i<8;i++)             
        {  
            if(crc&0x80)				//ï¿½ï¿½ï¿½Î»Î
                crc = (crc<<1)^0x07;	//ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½ï¿½
            else						//ï¿½ï¿½ï¿½ï¿½Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
                crc <<= 1;                    
        }
        crc8Table[j] = crc;//È¡ï¿½ï¿½ï¿½Ö½ï¿½
        LOGD("%2x ",crc);
    }
    LOGD("\r\n");
}

/*****************************************************************************
*function name:crc8withTable
*function: CRCÐ£ï¿½é£¬Ð£ï¿½ï¿½ÖµÎª8Î»
*input:addr-ï¿½ï¿½ï¿½ï¿½ï¿½×µï¿½Ö·ï¿½ï¿½len-ï¿½ï¿½ï¿½Ý³ï¿½ï¿½È£ï¿½ï¿½Ö½Ú£ï¿½ï¿½ï¿½crc8Table-CRC8ï¿½ï¿½
*output:8Î»Ð£ï¿½ï¿½Öµ
******************************************************************************/
uint8_t crc8withTable(uint8_t *addr, int len, uint8_t *crc8Table)  
{  
    uint8_t data;
    uint8_t crc = 00;							//ï¿½ï¿½Ê¼Öµ
    int i;

    for(;len>0;len--)               
    {  
        data = *addr++;
        crc = crc^data;						//ï¿½ï¿½crcï¿½ï¿½Ê¼Öµï¿½ï¿½ï¿
        crc = crc8Table[crc];				//ï¿½æ»»ï¿½ï¿½ï¿½ï¿½forÑ­ï¿½ï¿½
		//for (i = 0; i < 8; i++)			//Ñ­ï¿½ï¿½8Î» 
		//{  
		//	if (crc & 0x80)					//ï¿½ï¿½ï¿½ï¿½ï¿½Æ³ï¿½ï¿½ï¿½Î»Îª1ï¿½ï¿½ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½ï¿½
		//		crc = (crc << 1) ^ 0x07;    
		//	else							//ï¿½ï¿½ï¿½ï¿½Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
		//		crc <<= 1;                  
		//}
    }

    crc = crc^0x00;							//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿
    return(crc);							//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ð£ï¿½ï¿½Öµ
}

//////////////////////////////////////////////////////////////////////////////////////////
//ï¿½ï¿½3.3.3ï¿½Ðµï¿½CRC16ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ë±ï¿½Ã¿ï¿½ï¿½Ôªï¿½Ø¶ï¿½ï¿½ï¿½2ï¿½Ö½Ú£ï¿½Ò»ï¿½ï¿½256ï¿½ï¿½Ôªï¿½Ø¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Òª
//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö³ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ð¸ï¿½ï¿½Ö½Ú·ï¿½ï¿½ï¿½crcLowTableï¿½ï¿½ï¿½ï¿½ï¿½Ö½Ú·ï¿½ï¿½ï¿½crcHighTableï¿½ï¿½ï¿½ï¿½Ò²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÎªÊ²Ã´
//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç°ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä·ï¿½ï¿½ï¿½È·Êµï¿½ï¿½Êµï¿½Ö²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½É±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Â£ï¿
/*****************************************************************************
*function name:GenerateCrc16Table
*function: ï¿½ï¿½ï¿½ï¿½crc16ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÃµÄ±ï¿½ï¿½ï¿
*input: crcHighTableï¿½ï¿½crcLowTable:256ï¿½ï¿½Ð¡ï¿½ï¿½ï¿½ï¿½ï¿½é£¬ï¿½ï¿½ï¿½ï¿½ï¿½ÉµÄ±ï¿½ï¿½ï¿½ï¿½×µï¿½Ö· 
*output:ï¿½ï¿½
******************************************************************************/
void GenerateCrc16Table(uint8_t *crcHighTable, uint8_t *crcLowTable)  
{  
    uint16_t crc=0;
    uint16_t i,j;

    for(j=0;j<256;j++)
    {
        if(!(j%8))
            LOGD("\r\n");
 
        crc = j;
        for(i=0;i<8;i++)             
        {  
            if(crc&0x0001)       				//ï¿½ï¿½ï¿½ï¿½Ç°ï¿½ï¿½Íºï¿½ï¿½ï¿½Ê¡È¥ï¿½Ë·ï¿½×ªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÖµÎªï¿½ï¿½ï¿½ï¿½Ê½ï¿½Ä·ï¿½×ªÖ
                crc = (crc>>1)^0xA001;			//ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½×ªï¿½ï¿½ï¿½ï¿½ï¿½
            else                   				//ï¿½ï¿½ï¿½ï¿½Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
                crc >>= 1;                    
        }
        crcHighTable[j] = (uint8_t)(crc&0xff);		//È¡ï¿½ï¿½ï¿½Ö½ï¿½
        crcLowTable[j] = (uint8_t)((crc>>8)&0xff);	//È¡ï¿½ï¿½ï¿½Ö½ï¿½
        LOGD("%4x  ",crc);		
    }
    LOGD("\r\n");
}

/////////////////////////////////////////////////////////////////////////////////////
//ï¿½ï¿½ï¿½Ë±ï¿½ï¿½ï¿½ó£¬¾Í¿ï¿½ï¿½ï¿½Êµï¿½Ö²ï¿½ï¿½ï¿½ï¿½ï¿½Ë£ï¿½ÎªÊ²Ã´ï¿½ï¿½15-17ï¿½Ð´ï¿½ï¿½ï¿½ï¿½ï¿½Ò²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½æ¼°ï¿½ï¿½ï¿½Æµï¿½ï¿½ï¿½
//ï¿½ï¿½Ó­ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö¸ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Â£ï¿½
/*****************************************************************************
*function name:Crc16withTable
*function: ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½CRC
*input:  addrï¿½ï¿½ï¿½Ö·ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½Ö·ï¿½ï¿½len ï¿½ï¿½ï¿½Ö·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È£ï¿½tableï¿½ï¿½ï¿½Ãµï¿½ï¿½Ä±ï¿½ï¿½ï¿½
*output:ï¿½ï¿½
******************************************************************************/
uint16_t Crc16withTable(uint8_t *addr, int len, uint8_t *crcHighTable, uint8_t *crcLowTable)  
{  
    uint8_t crcHi = 0x00;
    uint8_t crcLo = 0x00;
    uint8_t index;
    uint16_t crc;

    for(;len>0;len--)             
    {  
        index = crcLo^*(addr++);				//ï¿½ï¿½8Î»ï¿½ï¿½ò£¬µÃµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö
        crcLo = crcHi^crcHighTable[index];
        crcHi = crcLowTable[index];
    }
    crc = (uint16_t)(crcHi<<8 | crcLo);
    return(crc^0xffff);							//ï¿½ï¿½ï¿½ï¿½Ð£ï¿½ï¿½Öµ
}

